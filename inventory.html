<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <title>Inventory | Bike Builders</title>
    <link rel="stylesheet" href="globals.css" />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="inventory.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body>
    <div class="hero-section inventory-hero">
      <div class="overlay">
        <div class="rectangle"></div>
        <div class="gradient"></div>
      </div>

      <nav class="navbar">
        <div class="logo">
          <img src="./assets/logo2.svg" class="logo-img" alt="" />
        </div>
        <ul class="nav-links">
          <li><a href="index.html">Home</a></li>
          <li><a href="inventory.html" class="active">Buy Bike</a></li>
          <li><a href="sell.html">Sell Your Bike</a></li>
          <li><a href="about.html">About Us</a></li>
          <li><a href="#" data-translate="Updates">Updates</a></li>
          <li><a href="contact.html" data-translate="Contact">Contact</a></li>
        </ul>
        <div class="login-btn">
          <a href="/getquote.html">
            <button>Get the Quote</button>
          </a>
        </div>
      </nav>
      <section class="inventory-section full-inventory">
        <div class="inventory-content">
          <!-- Left sidebar filters -->
          <div class="sidebar-filters">
            <div class="filters-container">
              <h3>Filters</h3>
              <div class="filter-group">
                <button class="filter-btn" data-filter="all">All Bikes</button>
              </div>

              <div class="filter-group">
                <button class="filter-btn" data-filter="price">
                  Price <i class="fas fa-chevron-down"></i>
                </button>
                <div class="filter-dropdown" id="price-dropdown">
                  <div class="price-range">
                    <div class="range-inputs">
                      <input
                        type="number"
                        id="min-price"
                        placeholder="Min"
                        min="0"
                      />
                      <span>to</span>
                      <input
                        type="number"
                        id="max-price"
                        placeholder="Max"
                        min="0"
                      />
                    </div>
                    <div class="price-presets">
                      <button
                        class="price-preset"
                        data-min="0"
                        data-max="50000"
                      >
                        Under 50K
                      </button>
                      <button
                        class="price-preset"
                        data-min="50000"
                        data-max="100000"
                      >
                        50K-1L
                      </button>
                      <button
                        class="price-preset"
                        data-min="100000"
                        data-max="200000"
                      >
                        1L-2L
                      </button>
                      <button
                        class="price-preset"
                        data-min="200000"
                        data-max="500000"
                      >
                        2L-5L
                      </button>
                      <button class="price-preset" data-min="500000">
                        5L+
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="filter-group">
                <button class="filter-btn" data-filter="brand">
                  Brand <i class="fas fa-chevron-down"></i>
                </button>
                <div class="filter-dropdown" id="brand-dropdown">
                  <div class="filter-options brand-options">
                    <button class="filter-option" data-brand="Bajaj">
                      Bajaj
                    </button>
                    <button class="filter-option" data-brand="BMW Motorrad">
                      BMW Motorrad
                    </button>
                    <button class="filter-option" data-brand="Ducati">
                      Ducati
                    </button>
                    <button class="filter-option" data-brand="Harley-Davidson">
                      Harley-Davidson
                    </button>
                    <button class="filter-option" data-brand="Hero">
                      Hero
                    </button>
                    <button class="filter-option" data-brand="Honda">
                      Honda
                    </button>
                    <button class="filter-option" data-brand="Kawasaki">
                      Kawasaki
                    </button>
                    <button class="filter-option" data-brand="KTM">KTM</button>
                    <button class="filter-option" data-brand="Royal Enfield">
                      Royal Enfield
                    </button>
                    <button class="filter-option" data-brand="Suzuki">
                      Suzuki
                    </button>
                    <button class="filter-option" data-brand="TVS">TVS</button>
                    <button class="filter-option" data-brand="Yamaha">
                      Yamaha
                    </button>
                  </div>
                </div>
              </div>
              <div class="filter-group">
                <button class="filter-btn" data-filter="year">
                  Year <i class="fas fa-chevron-down"></i>
                </button>
                <div class="filter-dropdown" id="year-dropdown">
                  <div class="year-slider">
                    <div class="slider-container">
                      <input
                        type="range"
                        id="year-min"
                        min="2015"
                        max="2024"
                        value="2015"
                        step="1"
                      />
                      <input
                        type="range"
                        id="year-max"
                        min="2015"
                        max="2024"
                        value="2024"
                        step="1"
                      />
                    </div>
                    <div class="year-values">
                      <span id="year-min-value">2015</span>
                      <span>to</span>
                      <span id="year-max-value">2024</span>
                    </div>
                  </div>
                </div>
              </div>

              <div class="filter-group">
                <button class="filter-btn" data-filter="km">
                  KM Driven <i class="fas fa-chevron-down"></i>
                </button>
                <div class="filter-dropdown" id="km-dropdown">
                  <div class="km-slider">
                    <div class="slider-container">
                      <input
                        type="range"
                        id="km-min"
                        min="0"
                        max="50000"
                        value="0"
                        step="500"
                      />
                      <input
                        type="range"
                        id="km-max"
                        min="0"
                        max="50000"
                        value="50000"
                        step="500"
                      />
                    </div>
                    <div class="km-values">
                      <span id="km-min-value">0</span>
                      <span>to</span>
                      <span id="km-max-value">50,000</span>
                      <span>km</span>
                    </div>
                  </div>
                </div>
              </div>

              <div class="filter-group">
                <button class="filter-btn" data-filter="owner">
                  Ownership <i class="fas fa-chevron-down"></i>
                </button>
                <div class="filter-dropdown" id="owner-dropdown">
                  <div class="filter-options ownership-options">
                    <button class="filter-option" data-owner="1">
                      1st Owner
                    </button>
                    <button class="filter-option" data-owner="2">
                      2nd Owner
                    </button>
                    <button class="filter-option" data-owner="3">
                      3+ Owner
                    </button>
                  </div>
                </div>
              </div>

              <div class="filter-group">
                <button class="filter-btn" data-filter="fuel">
                  Fuel Type <i class="fas fa-chevron-down"></i>
                </button>
                <div class="filter-dropdown" id="fuel-dropdown">
                  <div class="filter-options fuel-options">
                    <button class="filter-option" data-fuel="Petrol">
                      Petrol
                    </button>
                    <button class="filter-option" data-fuel="Electric">
                      Electric
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="bike-grid-container">
            <div class="section-header">
              <div class="search-container">
                <div class="search-box">
                  <input
                    type="text"
                    id="inventory-search"
                    placeholder="Search bikes by brand or model..."
                  />
                  <button id="search-btn"><i class="fas fa-search"></i></button>
                </div>

                <div class="sort-dropdown">
                  <button class="sort-btn">
                    <span id="sort-text">Sort: Default</span>
                    <i class="fas fa-chevron-down"></i>
                  </button>
                  <div class="sort-options">
                    <button class="sort-option" data-sort="default">
                      Default
                    </button>
                    <button class="sort-option" data-sort="price-low">
                      Price: Low to High
                    </button>
                    <button class="sort-option" data-sort="price-high">
                      Price: High to Low
                    </button>
                    <button class="sort-option" data-sort="year-new">
                      Year: Newest First
                    </button>
                    <button class="sort-option" data-sort="year-old">
                      Year: Oldest First
                    </button>
                  </div>
                </div>
              </div>
              <h2 id="filtered-count">0 Bikes Available</h2>
            </div>
            <div class="brand-logos-container">
              <div class="brand-logos">
                <div class="brand-logo" data-brand="Royal Enfield">
                  <img src="./assets/images/relogo.png" alt="Royal Enfield" />
                </div>
                <div class="brand-logo" data-brand="Bajaj">
                  <img
                    src="https://static.vecteezy.com/system/resources/previews/019/766/250/non_2x/bajaj-logo-bajaj-icon-transparent-free-png.png"
                    alt="Bajaj"
                  />
                </div>
                <div class="brand-logo" data-brand="Hero">
                  <img
                    src="https://brandeps.com/logo-download/H/Hero-MotoCorp-logo-01.png"
                    alt="Hero"
                  />
                </div>
                <div class="brand-logo" data-brand="Yamaha">
                  <img
                    src="https://brandlogos.net/wp-content/uploads/2014/10/yamaha_3d-logo_brandlogos.net_iwtkb.png"
                    alt="Yamaha"
                  />
                </div>
                <div class="brand-logo" data-brand="KTM">
                  <img
                    src="https://download.logo.wine/logo/KTM/KTM-Logo.wine.png"
                    alt="KTM"
                  />
                </div>
                <div class="brand-logo" data-brand="TVS">
                  <img
                    src="https://download.logo.wine/logo/TVS_Motor_Company/TVS_Motor_Company-Logo.wine.png"
                    alt="TVS"
                  />
                </div>
                <div class="brand-logo" data-brand="Honda">
                  <img
                    src="https://upload.wikimedia.org/wikipedia/commons/7/7b/Honda_Logo.svg"
                    alt="Honda"
                  />
                </div>
                <div class="brand-logo" data-brand="Suzuki">
                  <img
                    src="https://images.seeklogo.com/logo-png/13/2/suzuki-logo-png_seeklogo-134277.png"
                    alt="Suzuki"
                  />
                </div>
                <div class="brand-logo" data-brand="Jawa">
                  <img
                    src="https://1000logos.net/wp-content/uploads/2021/04/Jawa-logo.png"
                    alt="Jawa"
                  />
                </div>
                <div class="brand-logo" data-brand="BMW Motorrad">
                  <img
                    src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/44/BMW.svg/1200px-BMW.svg.png"
                    alt="BMW"
                  />
                </div>
                <div class="brand-logo" data-brand="Harley-Davidson">
                  <img
                    src="https://images.seeklogo.com/logo-png/21/2/harley-davidson-logo-png_seeklogo-216797.png"
                    alt="Harley"
                  />
                </div>

                <div class="brand-logo" data-brand="Kawasaki">
                  <img
                    src="https://animationvisarts.com/wp-content/uploads/2023/11/image-16-1030x521.png"
                    alt="Kawasaki"
                  />
                </div>
              </div>
            </div>
            <div class="bike-grid"></div>
          </div>
        </div>
      </section>
    </div>

    <footer class="footer">
      <div class="footer-content">
        <div class="footer-section">
          <div class="logo">
            <img
              src="./assets/logo2.svg"
              style="width: 50px"
              alt="Dan Electo Logo"
            />
          </div>
          <p>Bringing the future of bike riding to you today.</p>
          <div class="social-icons">
            <a href="https://www.facebook.com/share/1Ao18FYX8e/"
              ><i class="fa-brands fa-facebook-f" style="color: #0400ff"></i
            ></a>
            <a
              href="https://www.instagram.com/bikebuilders41?igsh=ZDk5M3NxdmI1Ymhp"
              aria-label="Visit our Instagram profile"
              ><img
                src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png"
                style="width: 20px"
            /></a>
            <a
              href="https://wa.me/918210283582"
              aria-label="Chat with us on WhatsApp"
              ><i class="fa-brands fa-whatsapp" style="color: #00a841"></i
            ></a>
            <a
              href="https://youtube.com/@bikebuilders-vo2nm?feature=shared"
              aria-label="Watch on Youtube"
              ><i class="fa-brands fa-youtube" style="color: #fa0000"></i
            ></a>
          </div>
        </div>
        <div class="footer-section">
          <h3>Quick Links</h3>
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="inventory.html">Buy Bike</a></li>
            <li><a href="sell.html">Sell Your Bike</a></li>
            <li><a href="about.html">About Us</a></li>
            <li><a href="#" data-translate="Updates">Updates</a></li>
            <li><a href="contact.html" data-translate="Contact">Contact</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h3>Contact Us</h3>
          <p>
            <i class="fas fa-map-marker-alt"></i> Rambag Chowk, Rambag Road
            Kabristaan k bagal me, Gaushala Chowk Mandir , Muzaffarpur, Bihar
            842002
          </p>
          <span itemprop="telephone"
            >+91 8210283582 / 7564987167 / 9825944897</span
          >
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2023 Bike Builders. All rights reserved.</p>
        <a href="www.pixelatenest.com" style="color: #a9a9a9"
          >Designed By Pixelate Nest</a
        >
      </div>
    </footer>
    <script>
      // Replace your existing script section with this fixed version
document.addEventListener("DOMContentLoaded", function () {
  let allBikes = [];
  let currentFilters = {
    brand: null,
    minPrice: 0,
    maxPrice: Infinity,
    minYear: 2015,
    maxYear: 2024,
    minKm: 0,
    maxKm: 50000,
    owner: null,
    fuel: null,
  };
  let currentSort = "default"; // Declare this ONCE at the top level

  function loadBikes() {
    fetch("https://bike-builders.onrender.com/api/bikes")
      .then((response) => {
        if (!response.ok) {
          throw new Error("Network response was not ok");
        }
        return response.json();
      })
      .then((bikes) => {
        allBikes = bikes;
        if (bikes.length === 0) {
          showNoBikesMessage();
        } else {
          applyAllFilters();
        }
      })
      .catch((error) => {
        console.error("Error fetching bikes:", error);
        showErrorMessage();
      });
  }

  // Initialize sort dropdown function - moved to top level
  function initSortDropdown() {
    const sortBtn = document.querySelector(".sort-btn");
    const sortOptions = document.querySelector(".sort-options");

    if (!sortBtn || !sortOptions) return; // Safety check

    sortBtn.addEventListener("click", function (e) {
      e.stopPropagation();
      sortOptions.style.display =
        sortOptions.style.display === "block" ? "none" : "block";
    });

    document.addEventListener("click", function (e) {
      if (!e.target.closest(".sort-dropdown")) {
        sortOptions.style.display = "none";
      }
    });

    document.querySelectorAll(".sort-option").forEach((option) => {
      option.addEventListener("click", function () {
        const sortType = this.dataset.sort;
        currentSort = sortType; // This now references the top-level variable
        
        // Update the sort button text
        document.getElementById("sort-text").textContent = `Sort: ${this.textContent}`;
        
        // Close the dropdown
        sortOptions.style.display = "none";
        
        // Apply filters with new sorting
        applyAllFilters();
      });
    });
  }

  function displayBikes(bikes) {
    const bikeGrid = document.querySelector(".bike-grid");
    bikeGrid.innerHTML = "";

    if (bikes.length === 0) {
      showNoBikesMessage();
      return;
    }

    bikes.forEach((bike) => {
      const bikeCard = createBikeCard(bike);
      bikeGrid.appendChild(bikeCard);
    });

    // Add click event listeners to bike cards for popup
    addBikeCardClickListeners();
  }

  // Create individual bike card
  function createBikeCard(bike) {
    const bikeCard = document.createElement("div");
    bikeCard.className = "bike-card";

    // Set data attributes for filtering
    bikeCard.dataset.brand = bike.brand || "";
    bikeCard.dataset.price = bike.price || 0;
    bikeCard.dataset.year = bike.modelYear || new Date().getFullYear();
    bikeCard.dataset.km = bike.kmDriven || 0;
    bikeCard.dataset.owner = bike.ownership || "1";
    bikeCard.dataset.fuel = bike.fuelType || "Petrol";

    // Store bike data for popup
    bikeCard.dataset.bikeData = JSON.stringify(bike);

    const statusClass =
      bike.status === "Available"
        ? "status-available"
        : bike.status === "Sold Out"
        ? "status-sold"
        : bike.status === "Coming Soon"
        ? "status-coming-soon"
        : "status-available";

    bikeCard.innerHTML = `
      <div class="image-container">
        <img src="${
          bike.imageUrl || "https://via.placeholder.com/300x200?text=No+Image"
        }" 
             alt="${bike.brand} ${bike.model}" 
             onerror="this.src='https://via.placeholder.com/300x200?text=No+Image'">
        <div class="status-badge ${statusClass}">${
          bike.status || "Available"
        }</div>
      </div>
      <div class="card-content">
        <h3>${bike.brand} ${bike.model}</h3>
        <span class="model">${bike.modelYear} Model</span>
        <div class="details">
          <div class="detail-item">
            <i class="fas fa-tachometer-alt"></i>
            <span>${(bike.kmDriven || 0).toLocaleString()} km</span>
          </div>
          <div class="detail-item">
            <i class="fas fa-user"></i>
            <span>${formatOwnership(bike.ownership || "1")}</span>
          </div>
          <div class="detail-item">
            <i class="fas fa-gas-pump"></i>
            <span>${bike.fuelType || "Petrol"}</span>
          </div>
          <div class="detail-item">
            <i class="fas fa-calendar-alt"></i>
            <span>${formatAge(bike.daysOld || 0)}</span>
          </div>
        </div>
        <div class="price-container">
          <div class="price">₹${(bike.price || 0).toLocaleString()}</div>
          <div class="emi">Down: ₹${(
            bike.downPayment || 0
          ).toLocaleString()} | EMI: ₹${Math.round(
            ((bike.price || 0) - (bike.downPayment || 0)) / 36
          ).toLocaleString()}/month</div>
          <div class="button-group">
            <button class="contact-btn" ${
              bike.status !== "Available" ? "disabled" : ""
            }>
              Contact Seller
            </button>
            <button class="view-details-btn" ${
              bike.status !== "Available" ? "disabled" : ""
            }>
              View Details
            </button>
          </div>
        </div>
      </div>
    `;
    return bikeCard;
  }

  // Helper function to format ownership
  function formatOwnership(owner) {
    if (owner === "1") return "1st Owner";
    if (owner === "2") return "2nd Owner";
    if (owner === "3") return "3+ Owner";
    return owner;
  }

  function addBikeCardClickListeners() {
    document.querySelectorAll(".bike-card").forEach((card) => {
      const viewDetailsBtn = card.querySelector(".view-details-btn");
      const contactBtn = card.querySelector(".contact-btn");

      if (viewDetailsBtn && !viewDetailsBtn.disabled) {
        viewDetailsBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          const bikeData = JSON.parse(card.dataset.bikeData);
          showBikePopup(bikeData);
        });
      }

      if (contactBtn && !contactBtn.disabled) {
        contactBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          window.location.href = "contact.html";
        });
      }
    });
  }

  // Show bike details popup
  function showBikePopup(bike) {
    const popup = document.querySelector(".bike-popup-overlay");

    // Populate popup with bike data
    document.getElementById("popup-bike-image").src =
      bike.imageUrl ||
      "https://via.placeholder.com/400x300?text=No+Image";
    document.getElementById(
      "popup-bike-title"
    ).textContent = `${bike.brand} ${bike.model}`;
    document.getElementById(
      "popup-bike-model"
    ).textContent = `${bike.modelYear} Model`;
    document.getElementById("popup-bike-km").textContent = `${(
      bike.kmDriven || 0
    ).toLocaleString()} km`;
    document.getElementById("popup-bike-owner").textContent =
      formatOwnership(bike.ownership || "1");
    document.getElementById("popup-bike-fuel").textContent =
      bike.fuelType || "Petrol";
    document.getElementById("popup-bike-age").textContent = formatAge(
      bike.daysOld || 0
    );
    document.getElementById("popup-bike-price").textContent = `₹${(
      bike.price || 0
    ).toLocaleString()}`;
    document.getElementById("popup-bike-emi").textContent = `Down: ₹${(
      bike.downPayment || 0
    ).toLocaleString()} | EMI: ₹${Math.round(
      ((bike.price || 0) - (bike.downPayment || 0)) / 36
    ).toLocaleString()}/month`;

    // Show popup
    popup.classList.add("active");
    document.body.style.overflow = "hidden";
  }

  // Close popup functionality
  function initPopupClose() {
    const popup = document.querySelector(".bike-popup-overlay");
    const closeBtn = document.querySelector(".close-popup");

    closeBtn.addEventListener("click", closePopup);

    popup.addEventListener("click", (e) => {
      if (e.target === popup) {
        closePopup();
      }
    });

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        closePopup();
      }
    });
  }

  function closePopup() {
    const popup = document.querySelector(".bike-popup-overlay");
    popup.classList.remove("active");
    document.body.style.overflow = "";
  }

  // Show no bikes message
  function showNoBikesMessage() {
    const bikeGrid = document.querySelector(".bike-grid");
    bikeGrid.innerHTML = `
      <div class="no-bikes-message" style="grid-column: 1 / -1; text-align: center; padding: 60px 20px;">
        <i class="fas fa-motorcycle" style="font-size: 4rem; color: #ccc; margin-bottom: 20px;"></i>
        <h3 style="color: #666; margin-bottom: 10px;">No Bikes Available</h3>
        <p style="color: #999;">New bikes coming soon! Check back later.</p>
      </div>
    `;
  }

  // Show error message
  function showErrorMessage() {
    const bikeGrid = document.querySelector(".bike-grid");
    bikeGrid.innerHTML = `
      <div class="error-message" style="grid-column: 1 / -1; text-align: center; padding: 60px 20px;">
        <i class="fas fa-exclamation-triangle" style="font-size: 4rem; color: #ff6b00; margin-bottom: 20px;"></i>
        <h3 style="color: #666; margin-bottom: 10px;">Failed to Load Bikes</h3>
        <p style="color: #999; margin-bottom: 20px;">Please check your connection and try again.</p>
        <button onclick="location.reload()" style="background: #ff6b00; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
          Retry
        </button>
      </div>
    `;
  }

  // Update bike count
  function updateBikeCount(count) {
    document.getElementById("filtered-count").textContent = `${count} ${
      count === 1 ? "Bike" : "Bikes"
    } Available`;
  }

  // Filter functionality
  function initFilters() {
    const filterButtons = document.querySelectorAll(".filter-btn");
    const filterDropdowns = document.querySelectorAll(".filter-dropdown");

    // Toggle filter dropdowns
    filterButtons.forEach((button) => {
      button.addEventListener("click", function (e) {
        e.stopPropagation();
        const filterType = this.dataset.filter;
        const dropdown = document.getElementById(
          `${filterType}-dropdown`
        );

        // Close all dropdowns first
        filterDropdowns.forEach((d) => {
          d.style.display = "none";
        });
        filterButtons.forEach((btn) => {
          btn.classList.remove("active");
        });

        // If "All Bikes" was clicked
        if (filterType === "all") {
          resetFilters();
          displayBikes(allBikes);
          updateBikeCount(allBikes.length);
          return;
        }

        // Toggle the clicked dropdown
        if (dropdown.style.display === "block") {
          dropdown.style.display = "none";
          this.classList.remove("active");
        } else {
          dropdown.style.display = "block";
          this.classList.add("active");
        }
      });
    });

    // Close dropdowns when clicking outside
    document.addEventListener("click", function (e) {
      if (
        !e.target.closest(".filter-btn") &&
        !e.target.closest(".filter-dropdown")
      ) {
        filterDropdowns.forEach((dropdown) => {
          dropdown.style.display = "none";
        });
        filterButtons.forEach((btn) => {
          btn.classList.remove("active");
        });
      }
    });

    // Initialize specific filters
    initPriceFilter();
    initBrandFilter();
    initYearFilter();
    initKmFilter();
    initOwnerFilter();
    initFuelFilter();
    initBrandLogos();
  }

  function initBrandLogos() {
    document.querySelectorAll(".brand-logo").forEach((logo) => {
      logo.addEventListener("click", function () {
        const brand = this.dataset.brand;
        currentFilters.brand = brand;

        // Clear any existing search term from URL
        if (window.location.search.includes("search=")) {
          window.history.pushState({}, "", "inventory.html");
        }

        applyAllFilters();

        // Update UI
        document.querySelectorAll(".brand-logo").forEach((l) => {
          l.classList.remove("active");
        });
        this.classList.add("active");

        // Update brand filter button text
        const brandBtn = document.querySelector('[data-filter="brand"]');
        brandBtn.innerHTML = `${brand} <i class="fas fa-chevron-down"></i>`;
      });
    });
  }

  // Price filter
  function initPriceFilter() {
    const minPriceInput = document.getElementById("min-price");
    const maxPriceInput = document.getElementById("max-price");

    if (minPriceInput && maxPriceInput) {
      minPriceInput.addEventListener("input", applyPriceFilter);
      maxPriceInput.addEventListener("input", applyPriceFilter);

      document.querySelectorAll(".price-preset").forEach((preset) => {
        preset.addEventListener("click", function () {
          minPriceInput.value = this.dataset.min;
          maxPriceInput.value = this.dataset.max || "";
          applyPriceFilter();
        });
      });
    }
  }

  // Initialize search functionality
  function initSearch() {
    const searchInput = document.getElementById("inventory-search");
    const searchBtn = document.getElementById("search-btn");

    // Handle search button click
    searchBtn.addEventListener("click", () => {
      const searchTerm = searchInput.value.trim();
      if (searchTerm) {
        // Update URL with search parameter
        window.history.pushState(
          {},
          "",
          `inventory.html?search=${encodeURIComponent(searchTerm)}`
        );
        applyAllFilters();
      }
    });

    searchInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        const searchTerm = searchInput.value.trim();
        if (searchTerm) {
          window.history.pushState(
            {},
            "",
            `inventory.html?search=${encodeURIComponent(searchTerm)}`
          );
          applyAllFilters();
        }
      }
    });

    // Check for search term in URL on page load
    const urlParams = new URLSearchParams(window.location.search);
    const searchTerm = urlParams.get("search");
    if (searchTerm) {
      searchInput.value = searchTerm;
      applyAllFilters();
    }
  }

  function applyPriceFilter() {
    const minPrice =
      parseInt(document.getElementById("min-price").value) || 0;
    const maxPrice =
      parseInt(document.getElementById("max-price").value) || Infinity;

    currentFilters.minPrice = minPrice;
    currentFilters.maxPrice = maxPrice;

    applyAllFilters();
  }

  // Brand filter
  function initBrandFilter() {
    document
      .querySelectorAll(".brand-options .filter-option")
      .forEach((option) => {
        option.addEventListener("click", function () {
          const brand = this.dataset.brand;
          currentFilters.brand =
            brand === currentFilters.brand ? null : brand;
          applyAllFilters();

          // Update button text
          const brandBtn = document.querySelector(
            '[data-filter="brand"]'
          );
          brandBtn.innerHTML = currentFilters.brand
            ? `${brand} <i class="fas fa-chevron-down"></i>`
            : `Brand <i class="fas fa-chevron-down"></i>`;

          // Update brand logos
          document.querySelectorAll(".brand-logo").forEach((logo) => {
            logo.classList.remove("active");
            if (
              currentFilters.brand &&
              logo.dataset.brand === currentFilters.brand
            ) {
              logo.classList.add("active");
            }
          });
        });
      });
  }

  // Year filter
  function initYearFilter() {
    const yearMin = document.getElementById("year-min");
    const yearMax = document.getElementById("year-max");
    const yearMinValue = document.getElementById("year-min-value");
    const yearMaxValue = document.getElementById("year-max-value");

    if (yearMin && yearMax) {
      yearMin.addEventListener("input", function () {
        yearMinValue.textContent = this.value;
        currentFilters.minYear = parseInt(this.value);
        applyAllFilters();
      });

      yearMax.addEventListener("input", function () {
        yearMaxValue.textContent = this.value;
        currentFilters.maxYear = parseInt(this.value);
        applyAllFilters();
      });
    }
  }

  // KM filter
  function initKmFilter() {
    const kmMin = document.getElementById("km-min");
    const kmMax = document.getElementById("km-max");
    const kmMinValue = document.getElementById("km-min-value");
    const kmMaxValue = document.getElementById("km-max-value");

    if (kmMin && kmMax) {
      kmMin.addEventListener("input", function () {
        kmMinValue.textContent = parseInt(this.value).toLocaleString();
        currentFilters.minKm = parseInt(this.value);
        applyAllFilters();
      });

      kmMax.addEventListener("input", function () {
        kmMaxValue.textContent = parseInt(this.value).toLocaleString();
        currentFilters.maxKm = parseInt(this.value);
        applyAllFilters();
      });
    }
  }

  // Owner filter
  function initOwnerFilter() {
    document
      .querySelectorAll(".ownership-options .filter-option")
      .forEach((option) => {
        option.addEventListener("click", function () {
          const owner = this.dataset.owner;
          currentFilters.owner =
            owner === currentFilters.owner ? null : owner;
          applyAllFilters();

          // Update button text if needed
          const ownerBtn = document.querySelector(
            '[data-filter="owner"]'
          );
          if (ownerBtn) {
            ownerBtn.innerHTML = currentFilters.owner
              ? `${formatOwnership(
                  owner
                )} <i class="fas fa-chevron-down"></i>`
              : `Ownership <i class="fas fa-chevron-down"></i>`;
          }
        });
      });
  }

  // Fuel filter
  function initFuelFilter() {
    document
      .querySelectorAll(".fuel-options .filter-option")
      .forEach((option) => {
        option.addEventListener("click", function () {
          const fuel = this.dataset.fuel;
          currentFilters.fuel =
            fuel === currentFilters.fuel ? null : fuel;
          applyAllFilters();

          // Update button text if needed
          const fuelBtn = document.querySelector('[data-filter="fuel"]');
          if (fuelBtn) {
            fuelBtn.innerHTML = currentFilters.fuel
              ? `${fuel} <i class="fas fa-chevron-down"></i>`
              : `Fuel Type <i class="fas fa-chevron-down"></i>`;
          }
        });
      });
  }

  function getSearchParam() {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get("search")?.toLowerCase() || "";
  }

  function applyAllFilters() {
    const searchTerm = getSearchParam().trim().toLowerCase();
    const filteredBikes = allBikes.filter((bike) => {
      if (searchTerm) {
        const brand = (bike.brand || "").toLowerCase();
        const model = (bike.model || "").toLowerCase();

        const searchMatch =
          model.includes(searchTerm) ||
          `${brand} ${model}`.includes(searchTerm) ||
          model
            .replace(/\s+/g, "")
            .includes(searchTerm.replace(/\s+/g, ""));

        if (!searchMatch) return false;
      }
      const price = bike.price || 0;
      const year = bike.modelYear || new Date().getFullYear();
      const km = bike.kmDriven || 0;
      const brand = (bike.brand || "").toLowerCase();
      const owner = bike.ownership || "";
      const fuel = bike.fuelType || "";

      const priceMatch =
        price >= currentFilters.minPrice &&
        price <= currentFilters.maxPrice;
      const yearMatch =
        year >= currentFilters.minYear && year <= currentFilters.maxYear;
      const kmMatch =
        km >= currentFilters.minKm && km <= currentFilters.maxKm;
      const brandMatch =
        !currentFilters.brand ||
        brand === currentFilters.brand.toLowerCase();
      const ownerMatch =
        !currentFilters.owner || owner.includes(currentFilters.owner);
      const fuelMatch =
        !currentFilters.fuel || fuel === currentFilters.fuel;

      return (
        priceMatch &&
        yearMatch &&
        kmMatch &&
        brandMatch &&
        ownerMatch &&
        fuelMatch
      );
    });
    
    const sortedBikes = sortBikes(filteredBikes, currentSort);
    displayBikes(sortedBikes);
    updateBikeCount(sortedBikes.length);

    if (searchTerm) {
      showSearchTerm(searchTerm);
    }
  }

  function sortBikes(bikes, sortType) {
    switch (sortType) {
      case "price-low":
        return [...bikes].sort((a, b) => (a.price || 0) - (b.price || 0));
      case "price-high":
        return [...bikes].sort((a, b) => (b.price || 0) - (a.price || 0));
      case "year-new":
        return [...bikes].sort(
          (a, b) => (b.modelYear || 0) - (a.modelYear || 0)
        );
      case "year-old":
        return [...bikes].sort(
          (a, b) => (a.modelYear || 0) - (b.modelYear || 0)
        );
      default:
        return bikes; // Default sorting (original order)
    }
  }

  function showSearchTerm(term) {
    const existingDisplay = document.querySelector(
      ".search-term-display"
    );
    if (existingDisplay) {
      existingDisplay.remove();
    }

    const searchContainer = document.createElement("div");
    searchContainer.className = "search-term-display";

    const searchText = document.createElement("span");
    searchText.textContent = `Showing results for: ${term}`;
    searchText.className = "search-term-text";

    const clearBtn = document.createElement("button");
    clearBtn.className = "clear-search-btn";
    clearBtn.innerHTML = "&times;";
    clearBtn.title = "Clear search";
    clearBtn.addEventListener("click", () => {
      window.location.href = "inventory.html";
    });

    searchContainer.appendChild(searchText);
    searchContainer.appendChild(clearBtn);

    const sectionHeader = document.querySelector(".section-header");
    if (sectionHeader) {
      sectionHeader.insertBefore(
        searchContainer,
        sectionHeader.firstChild
      );
    }
  }

  function resetFilters() {
    currentFilters = {
      brand: null,
      minPrice: 0,
      maxPrice: Infinity,
      minYear: 2015,
      maxYear: 2024,
      minKm: 0,
      maxKm: 50000,
      owner: null,
      fuel: null,
    };

    // Reset form inputs
    document.getElementById("min-price").value = "";
    document.getElementById("max-price").value = "";
    document.getElementById("year-min").value = "2015";
    document.getElementById("year-max").value = "2024";
    document.getElementById("km-min").value = "0";
    document.getElementById("km-max").value = "50000";

    // Reset display values
    document.getElementById("year-min-value").textContent = "2015";
    document.getElementById("year-max-value").textContent = "2024";
    document.getElementById("km-min-value").textContent = "0";
    document.getElementById("km-max-value").textContent = "50,000";

    // Reset all filter button texts
    const brandBtn = document.querySelector('[data-filter="brand"]');
    brandBtn.innerHTML = `Brand <i class="fas fa-chevron-down"></i>`;

    const ownerBtn = document.querySelector('[data-filter="owner"]');
    if (ownerBtn) {
      ownerBtn.innerHTML = `Ownership <i class="fas fa-chevron-down"></i>`;
    }

    const fuelBtn = document.querySelector('[data-filter="fuel"]');
    if (fuelBtn) {
      fuelBtn.innerHTML = `Fuel Type <i class="fas fa-chevron-down"></i>`;
    }

    // Reset brand logos
    document.querySelectorAll(".brand-logo").forEach((logo) => {
      logo.classList.remove("active");
    });
  }

  // Format age for display
  function formatAge(days) {
    if (days >= 365) {
      const years = Math.floor(days / 365);
      return `${years} year${years > 1 ? "s" : ""}`;
    } else if (days >= 30) {
      const months = Math.floor(days / 30);
      return `${months} month${months > 1 ? "s" : ""}`;
    } else {
      return `${days} day${days !== 1 ? "s" : ""}`;
    }
  }

  // Initialize everything
  loadBikes();
  initFilters();
  initPopupClose();
  initSortDropdown(); // Now this will work properly
  initSearch(); // Initialize search functionality
});
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const toggleBtn = document.createElement("button");
        toggleBtn.className = "mobile-menu-toggle";
        toggleBtn.innerHTML = '<i class="fas fa-bars"></i>';

        const navbar = document.querySelector(".navbar");
        navbar.appendChild(toggleBtn);

        const mobileMenu = document.createElement("div");
        mobileMenu.className = "mobile-menu";
        mobileMenu.innerHTML = `
      <button class="close-btn"><i class="fas fa-times"></i></button>
      <ul class="nav-links">
        <li><a href="index.html" class="active">Home</a></li>
        <li><a href="inventory.html">Buy Bike</a></li>
        <li><a href="sell.html">Sell Your Bike</a></li>
        <li><a href="about.html">About Us</a></li>
                  <li><a href="#" data-translate="Updates">Updates</a></li>
          <li><a href="contact.html" data-translate="Contact">Contact</a></li>
      </ul>
      <div class="login-btn">
        <button>Get the Quote</button>
      </div>
    `;

        document.body.appendChild(mobileMenu);

        toggleBtn.addEventListener("click", function () {
          mobileMenu.classList.add("active");
        });

        mobileMenu
          .querySelector(".close-btn")
          .addEventListener("click", function () {
            mobileMenu.classList.remove("active");
          });
      });
      // Add this function near the top of your script section
      function formatAge(days) {
        if (days >= 365) {
          const years = Math.floor(days / 365);
          return `${years} year${years > 1 ? "s" : ""}`;
        } else if (days >= 30) {
          const months = Math.floor(days / 30);
          return `${months} month${months > 1 ? "s" : ""}`;
        } else {
          return `${days} day${days !== 1 ? "s" : ""}`;
        }
      }
    </script>
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-ETL311CBE6"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-ETL311CBE6");
    </script>
    <div class="bike-popup-overlay">
      <div class="bike-popup">
        <button class="close-popup">&times;</button>
        <div class="popup-content">
          <div class="popup-image-container">
            <img id="popup-bike-image" src="" alt="Bike Image" />
          </div>
          <div class="popup-details">
            <h2 id="popup-bike-title"></h2>
            <span class="model" id="popup-bike-model"></span>
            <div class="details">
              <div class="detail-item">
                <i class="fas fa-tachometer-alt"></i>
                <span id="popup-bike-km"></span>
              </div>
              <div class="detail-item">
                <i class="fas fa-user"></i>
                <span id="popup-bike-owner"></span>
              </div>
              <div class="detail-item">
                <i class="fas fa-gas-pump"></i>
                <span id="popup-bike-fuel"></span>
              </div>
              <div class="detail-item">
                <i class="fas fa-calendar-alt"></i>
                <span id="popup-bike-age"></span>
              </div>
            </div>
            <div class="price-container">
              <div class="price" id="popup-bike-price"></div>
              <div class="emi" id="popup-bike-emi"></div>
            </div>

            <button class="contact-btn">Contact Seller</button>
          </div>
        </div>
      </div>
    </div>
    <div class="floating-buttons">
      <a
        href="https://wa.me/918210283582"
        class="floating-btn whatsapp-btn"
        data-tooltip="Chat on WhatsApp"
        aria-label="Chat on WhatsApp"
      >
        <i class="fa-brands fa-whatsapp fa-bounce"></i>
      </a>
      <a
        href="https://youtube.com/@bikebuilders-vo2nm?feature=shared"
        class="floating-btn youtube-btn"
        data-tooltip="Watch on YouTube"
        aria-label="Watch on YouTube"
      >
        <i class="fa-brands fa-youtube fa-beat-fade" style="color: #ff0000"></i>
      </a>
      <a
        href="tel:+918210283582"
        class="floating-btn call-btn"
        data-tooltip="Call Us"
        aria-label="Call Us"
      >
        <i class="fa-solid fa-phone-volume fa-shake"></i>
      </a>
    </div>
  </body>
</html>
