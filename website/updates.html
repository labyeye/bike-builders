<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <title>Updates | Bike Builders</title>
    <link rel="stylesheet" href="./globals.css" />
    <link rel="stylesheet" href="./style.css" />
    <link rel="stylesheet" href="./updates.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    
    <style>
      /* Loading and error states */
      .loading-spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top: 4px solid #4CAF50;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 2rem auto;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      .error-message, .no-offers {
        color: white;
        text-align: center;
        padding: 2rem;
        background: rgba(255, 0, 0, 0.2);
        border-radius: 8px;
        width: 100%;
      }
      
      .no-offers {
        background: rgba(255, 255, 255, 0.1);
      }
      
      /* Offer type indicators */
      .offer-badge {
        position: absolute;
        top: 15px;
        right: 15px;
        padding: 3px 8px;
        border-radius: 12px;
        font-size: 0.7rem;
        font-weight: bold;
        text-transform: uppercase;
      }
      
      .offer-type-new { background: #00BCD4; color: white; }
      .offer-type-sale { background: #2196F3; color: white; }
      .offer-type-event { background: #9C27B0; color: white; }
      .offer-type-festival { background: #FF5722; color: white; }
    </style>
  </head>
  <body>
    <div class="hero-section updates-hero">
      <div class="overlay">
        <div class="rectangle"></div>
        <div class="gradient"></div>
      </div>

      <nav class="navbar">
        <a href="index.html" class="logo-link">
          <div class="logo">
            <img src="./assets/logo2.svg" class="logo-img" alt="Bike Builders Logo" itemprop="logo" />
          </div>
        </a>
        <ul class="nav-links">
          <li><a href="index.html" data-translate="Home">Home</a></li>
          <li><a href="inventory.html" data-translate="Buy Bike">Buy Bike</a></li>
          <li><a href="sell.html" data-translate="Sell Your Bike">Sell Your Bike</a></li>
          <li><a href="about.html" aria-label="About Bike Builders" data-translate="About Us">About Us</a></li>
          <li><a href="book.html" aria-label="Book Bike" data-translate="Book Bike">Book Bike</a></li>
          <li><a href="./updates.html" data-translate="Updates" class="active">Updates</a></li>
          <li><a href="contact.html" data-translate="Contact">Contact</a></li>
        </ul>
        <div class="login-btn">
          <a href="/getquote.html">
            <button data-translate="Get the Quote">Get the Quote</button>
          </a>
        </div>
        <div class="theme-toggle">
          <input
            type="checkbox"
            id="darkModeToggle"
            aria-label="Toggle dark mode"
          />
          <label for="darkModeToggle" class="toggle-label">
            <i class="fas fa-sun"></i>
            <i class="fas fa-moon"></i>
            <span class="toggle-ball"></span>
          </label>
        </div>
      </nav>
      
      <section class="updates-section">
        <div class="updates-content">
          <h2 data-translate="Latest Updates">Latest Updates</h2>
          <p data-translate="Stay informed with the latest news, offers, and announcements from Bike Builders.">
            Stay informed with the latest news, offers, and announcements from Bike Builders.
          </p>
        </div>

        <div class="updates-container" id="updates-container">
          <div class="loading-spinner"></div>
        </div>
      </section>
    </div>

    <!-- Review Section -->
    <section class="testimonials-section">
      <h2>What Our Riders Say</h2>
      <div class="testimonials-container" id="dynamic-testimonials">
        <div class="loading">Loading reviews...</div>
      </div>
    </section>
    <!-- Review Modal -->
    <div id="reviewModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h3>Leave a Review</h3>
        <form id="reviewForm">
          <input type="text" id="reviewName" placeholder="Your Name" required />
          <textarea id="reviewMessage" placeholder="Your Review" required></textarea>
          <div class="star-rating">
            <span class="star" data-value="1"><i class="fa fa-star"></i></span>
            <span class="star" data-value="2"><i class="fa fa-star"></i></span>
            <span class="star" data-value="3"><i class="fa fa-star"></i></span>
            <span class="star" data-value="4"><i class="fa fa-star"></i></span>
            <span class="star" data-value="5"><i class="fa fa-star"></i></span>
          </div>
          <input type="hidden" id="reviewRating" value="0" required />
          <button type="submit" class="submit-btn">Submit</button>
        </form>
      </div>
    </div>
    <footer class="footer">
      <div class="footer-content">
        <div class="footer-section">
          <!-- 5-Star Rating Display -->
          <div class="footer-stars" style="margin: 10px 0;">
            <span class="star" style="color: gold; font-size: 1.5em;"><i class="fa fa-star"></i></span>
            <span class="star" style="color: gold; font-size: 1.5em;"><i class="fa fa-star"></i></span>
            <span class="star" style="color: gold; font-size: 1.5em;"><i class="fa fa-star"></i></span>
            <span class="star" style="color: gold; font-size: 1.5em;"><i class="fa fa-star"></i></span>
            <span class="star" style="color: gold; font-size: 1.5em;"><i class="fa fa-star"></i></span>
          </div>
          <div class="logo">
            <img src="./assets/logo2.svg" style="width: 50px" alt="Bike Builders Logo" />
          </div>
          <p data-translate="Bringing the future of bike riding to you today.">
            Bringing the future of bike riding to you today.
          </p>
          <div class="social-icons">
            <a href="https://www.facebook.com/share/1Ao18FYX8e/">
              <i class="fa-brands fa-facebook-f" style="color: #0400ff"></i>
            </a>
            <a href="https://www.instagram.com/bikebuilders41?igsh=ZDk5M3NxdmI1Ymhp" aria-label="Visit our Instagram profile">
              <img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png" style="width: 20px" />
            </a>
            <a href="https://wa.me/918210283582">
              <i class="fa-brands fa-whatsapp" style="color: #00a841"></i>
            </a>
          </div>
        </div>
        <div class="footer-section">
          <h3 data-translate="Quick Links">Quick Links</h3>
          <ul>
            <li><a href="index.html" data-translate="Home">Home</a></li>
            <li><a href="inventory.html" data-translate="Buy Bike">Buy Bike</a></li>
            <li><a href="sell.html" data-translate="Sell Your Bike">Sell Your Bike</a></li>
            <li><a href="about.html" aria-label="About Bike Builders" data-translate="About Us">About Us</a></li>
            <li><a href="book.html" aria-label="Book Bike" data-translate="Book Bike">Book Bike</a></li>
            <li><a href="./updates.html" data-translate="Updates" class="active">Updates</a></li>
            <li><a href="contact.html" data-translate="Contact">Contact</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h3 data-translate="Contact Us">Contact Us</h3>
          <p data-translate="Rambag Chowk, Rambag Road Kabristaan k bagal me, Gaushala Chowk Mandir , Muzaffarpur, Bihar 842002">
            <i class="fas fa-map-marker-alt"></i> Rambag Chowk, Rambag Road Kabristaan k bagal me, Gaushala Chowk Mandir , Muzaffarpur, Bihar 842002
          </p>
          <span itemprop="telephone">+91 8210283582 /  9835844897</span>
        </div>
      </div>
      <div class="footer-bottom">
        <p data-translate="&copy; 2023 Bike Builders. All rights reserved.">
          &copy; 2023 Bike Builders. All rights reserved.
        </p>
        <a href="www.pixelatenest.com" style="color: #a9a9a9" data-translate="Designed By Pixelate Nest">
          Designed By Pixelate Nest
        </a>
      </div>
    </footer>

    <script>
      // Dynamic testimonials fetch
      document.addEventListener("DOMContentLoaded", function () {
        function getInitials(name) {
          if (!name) return "U";
          return name
            .split(" ")
            .map((n) => n[0].toUpperCase())
            .join("")
            .slice(0, 2);
        }
        function randomAvatar(name) {
          // Use dicebear for demo, fallback to initials
          const seed = name ? name.replace(/\s/g, "") : "user";
          return `https://api.dicebear.com/7.x/initials/svg?seed=${encodeURIComponent(seed)}`;
        }
        function renderTestimonials(reviews) {
          const container = document.getElementById("dynamic-testimonials");
          if (!reviews || reviews.length === 0) {
            container.innerHTML = '<div class="no-reviews">No reviews yet.</div>';
            return;
          }
          container.innerHTML = reviews
            .map((r) => `
              <div class="testimonial" itemscope itemtype="https://schema.org/Review">
                <div class="quote-icon">
                  <i class="fas fa-quote-right" aria-hidden="true"></i>
                </div>
                <div class="testimonial-header">
                  <img src="${randomAvatar(r.name)}" alt="${r.name}" class="user-avatar" width="60" height="60" loading="lazy" />
                  <div class="user-info">
                    <h4 class="user-name" itemprop="author">${r.name}</h4>
                    <div class="rating" itemprop="reviewRating" itemscope itemtype="https://schema.org/Rating">
                      <meta itemprop="ratingValue" content="${r.rating}" />
                      ${'<i class="fas fa-star"></i>'.repeat(r.rating)}${'<i class="far fa-star"></i>'.repeat(5 - r.rating)}
                    </div>
                  </div>
                </div>
                <div class="quote" itemprop="reviewBody">${r.message}</div>
                <div class="testimonial-footer">
                  <span class="testimonial-date">${new Date(r.date).toLocaleDateString()}</span>
                </div>
                <meta itemprop="itemReviewed" content="Bike Builders" />
              </div>
            `)
            .join("");
        }
        function fetchTestimonials() {
          fetch("https://bike-builders-1.onrender.com/api/reviews")
            .then((res) => res.json())
            .then((data) => {
              if (data.success && Array.isArray(data.reviews)) {
                renderTestimonials(data.reviews);
              } else {
                renderTestimonials([]);
              }
            })
            .catch(() => {
              renderTestimonials([]);
            });
        }
        fetchTestimonials();

        // Review Modal logic
        const reviewModal = document.getElementById("reviewModal");
        const closeReviewModalBtn = reviewModal.querySelector(".close");
        closeReviewModalBtn.addEventListener("click", () => {
          reviewModal.style.display = "none";
        });
        window.addEventListener("click", function (event) {
          if (event.target == reviewModal) {
            reviewModal.style.display = "none";
          }
        });
        // Star rating logic
        const stars = reviewModal.querySelectorAll(".star");
        const ratingInput = document.getElementById("reviewRating");
        stars.forEach((star) => {
          star.addEventListener("click", function () {
            const val = this.getAttribute("data-value");
            ratingInput.value = val;
            stars.forEach((s, i) => {
              s.classList.toggle("selected", i < val);
            });
          });
        });
        // Submit review
        const reviewForm = document.getElementById("reviewForm");
        reviewForm.addEventListener("submit", function (e) {
          e.preventDefault();
          const name = document.getElementById("reviewName").value.trim();
          const message = document.getElementById("reviewMessage").value.trim();
          const rating = Number(document.getElementById("reviewRating").value);
          if (!name || !message || !rating) {
            alert("Please fill all fields and select a rating.");
            return;
          }
          fetch("https://bike-builders-1.onrender.com/api/reviews", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, message, rating })
          })
            .then((res) => res.json())
            .then((data) => {
              if (data.success) {
                reviewModal.style.display = "none";
                reviewForm.reset();
                ratingInput.value = 0;
                stars.forEach((s) => s.classList.remove("selected"));
                fetchTestimonials();
              } else {
                alert("Failed to submit review.");
              }
            })
            .catch(() => alert("Failed to submit review."));
        });
        // Open modal button (add anywhere you want, e.g. after testimonials)
        const openBtn = document.createElement("button");
        openBtn.textContent = "Leave a Review";
        openBtn.className = "review-btn";
        openBtn.onclick = () => { reviewModal.style.display = "block"; };
        document.querySelector(".testimonials-section").appendChild(openBtn);
      });
      document.addEventListener("DOMContentLoaded", function () {
         const toggleBtn = document.createElement("button");
        toggleBtn.className = "mobile-menu-toggle";
        toggleBtn.innerHTML = '<i class="fas fa-bars"></i>';

        const navbar = document.querySelector(".navbar");
        navbar.appendChild(toggleBtn);

        const mobileMenu = document.createElement("div");
        mobileMenu.className = "mobile-menu";
        mobileMenu.innerHTML = `
          <button class="close-btn"><i class="fas fa-times"></i></button>
          <ul class="nav-links">
            <li><a href="index.html" class="active">Home</a></li>
            <li><a href="inventory.html">Buy Bike</a></li>
            <li><a href="sell.html">Sell Your Bike</a></li>
            <li><a href="about.html">About Us</a></li>
            <li><a href="updates.html" data-translate="Updates">Updates</a></li>
            <li><a href="contact.html" data-translate="Contact">Contact</a></li>
          </ul>
          <div class="login-btn">
            <button>Get the Quote</button>
          </div>
          <div class="theme-toggle mobile-theme-toggle">
          <label for="mobileDarkModeToggle" class="toggle-label">
            <i class="fas fa-sun"></i>
            <i class="fas fa-moon"></i>
            <span class="toggle-ball"></span>
          </label>
        </div>
        `;

        document.body.appendChild(mobileMenu);

        toggleBtn.addEventListener("click", function () {
          mobileMenu.classList.add("active");
        });

        mobileMenu
          .querySelector(".close-btn")
          .addEventListener("click", function () {
            mobileMenu.classList.remove("active");
          });
        // Translation functionality
        const translations = {
          en: {
            "Latest Updates": "Latest Updates",
            "Stay informed with the latest news, offers, and announcements from Bike Builders.": 
              "Stay informed with the latest news, offers, and announcements from Bike Builders.",
            "View Offer": "View Offer",
            "Learn More": "Learn More",
            "New": "New",
            "Sale": "Sale",
            "Event": "Event",
            "Festival": "Festival",
            "No current offers available. Check back later!": "No current offers available. Check back later!",
            "Failed to load updates. Please try again later.": "Failed to load updates. Please try again later."
          },
          hi: {
            "Latest Updates": "नवीनतम अपडेट",
            "Stay informed with the latest news, offers, and announcements from Bike Builders.": 
              "Bike Builders के नवीनतम समाचार, ऑफ़र और घोषणाओं के बारे में जानकारी रखें।",
            "View Offer": "ऑफ़र देखें",
            "Learn More": "और जानें",
            "New": "नया",
            "Sale": "बिक्री",
            "Event": "कार्यक्रम",
            "Festival": "त्योहार",
            "No current offers available. Check back later!": "कोई वर्तमान ऑफर उपलब्ध नहीं है। बाद में पुनः जांचें!",
            "Failed to load updates. Please try again later.": "अपडेट लोड करने में विफल। कृपया बाद में पुनः प्रयास करें।"
          }
        };

        const preferredLanguage = localStorage.getItem("preferredLanguage") || "en";

        function translateText() {
          if (preferredLanguage !== "en") {
            document.body.classList.add("hindi-font");
            const elements = document.querySelectorAll("[data-translate]");
            elements.forEach((element) => {
              const key = element.getAttribute("data-translate");
              if (translations[preferredLanguage] && translations[preferredLanguage][key]) {
                element.textContent = translations[preferredLanguage][key];
              }
            });
          }
        }

        translateText();

        // Fetch offers from backend
        fetch('https://bike-builders-1.onrender.com/api/offers')
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.json();
          })
          .then(offers => {
            const container = document.getElementById('updates-container');
            container.innerHTML = '';
            
            if (offers.error) {
              container.innerHTML = `
                <p class="error-message" data-translate="Failed to load updates. Please try again later.">
                  ${translations[preferredLanguage]["Failed to load updates. Please try again later."]}
                </p>
              `;
              return;
            }

            if (offers.length === 0) {
              container.innerHTML = `
                <p class="no-offers" data-translate="No current offers available. Check back later!">
                  ${translations[preferredLanguage]["No current offers available. Check back later!"]}
                </p>
              `;
              return;
            }

            offers.forEach((offer, index) => {
              const offerDate = new Date(offer.startDate).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
              });
              
              const offerCard = document.createElement('div');
              offerCard.className = 'update-card';
              offerCard.dataset.type = offer.type;
              offerCard.style.animationDelay = `${index * 0.1}s`;
              
              const typeTranslation = translations[preferredLanguage][offer.type.charAt(0).toUpperCase() + offer.type.slice(1)] || offer.type;
              
              offerCard.innerHTML = `
                <span class="offer-badge offer-type-${offer.type}">${typeTranslation}</span>
                <div class="update-date">${offerDate}</div>
                <h3 class="update-title">${offer.title}</h3>
                <p class="update-description">${offer.description}</p>
                <a href="${offer.link || '#'}" class="update-link">
                  ${offer.cta || translations[preferredLanguage]["Learn More"]}
                </a>
              `;
              
              container.appendChild(offerCard);
            });
          })
          .catch(error => {
            console.error('Error fetching offers:', error);
            const container = document.getElementById('updates-container');
            container.innerHTML = `
              <p class="error-message" data-translate="Failed to load updates. Please try again later.">
                ${translations[preferredLanguage]["Failed to load updates. Please try again later."]}
              </p>
            `;
          });
      });
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const darkModeToggle = document.getElementById("darkModeToggle");
        const mobileDarkModeToggle = document.getElementById(
          "mobileDarkModeToggle"
        );

        // Check for saved user preference or system preference
        function checkDarkModePreference() {
          const savedTheme = localStorage.getItem("theme");
          const systemPrefersDark =
            window.matchMedia &&
            window.matchMedia("(prefers-color-scheme: dark)").matches;

          if (savedTheme === "dark" || (!savedTheme && systemPrefersDark)) {
            document.body.classList.add("dark-mode");
            if (darkModeToggle) darkModeToggle.checked = true;
            if (mobileDarkModeToggle) mobileDarkModeToggle.checked = true;
          }
        }

        // Initialize dark mode
        checkDarkModePreference();

        // Desktop toggle
        if (darkModeToggle) {
          darkModeToggle.addEventListener("change", function () {
            if (this.checked) {
              document.body.classList.add("dark-mode");
              localStorage.setItem("theme", "dark");
            } else {
              document.body.classList.remove("dark-mode");
              localStorage.setItem("theme", "light");
            }
            // Sync mobile toggle
            if (mobileDarkModeToggle) {
              mobileDarkModeToggle.checked = this.checked;
            }
          });
        }

        // Mobile toggle
        if (mobileDarkModeToggle) {
          mobileDarkModeToggle.addEventListener("change", function () {
            if (this.checked) {
              document.body.classList.add("dark-mode");
              localStorage.setItem("theme", "dark");
            } else {
              document.body.classList.remove("dark-mode");
              localStorage.setItem("theme", "light");
            }
            // Sync desktop toggle
            if (darkModeToggle) {
              darkModeToggle.checked = this.checked;
            }
          });
        }

        // Watch for system theme changes
        window
          .matchMedia("(prefers-color-scheme: dark)")
          .addEventListener("change", (e) => {
            const newColorScheme = e.matches ? "dark" : "light";
            if (!localStorage.getItem("theme")) {
              // Only if user hasn't set a preference
              if (newColorScheme === "dark") {
                document.body.classList.add("dark-mode");
                if (darkModeToggle) darkModeToggle.checked = true;
                if (mobileDarkModeToggle) mobileDarkModeToggle.checked = true;
              } else {
                document.body.classList.remove("dark-mode");
                if (darkModeToggle) darkModeToggle.checked = false;
                if (mobileDarkModeToggle) mobileDarkModeToggle.checked = false;
              }
            }
          });
      });
    </script>
     <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Get modal elements
        const whatsappModal = document.getElementById("whatsappModal");
        const callModal = document.getElementById("callModal");

        // Get trigger buttons
        const whatsappTrigger = document.getElementById("whatsappTrigger");
        const callTrigger = document.getElementById("callTrigger");

        // Get close buttons
        const closeButtons = document.getElementsByClassName("close");

        // When user clicks WhatsApp button
        whatsappTrigger.addEventListener("click", function (e) {
          e.preventDefault();
          whatsappModal.style.display = "block";
        });

        // When user clicks Call button
        callTrigger.addEventListener("click", function (e) {
          e.preventDefault();
          callModal.style.display = "block";
        });

        // When user clicks on close button
        Array.from(closeButtons).forEach((button) => {
          button.addEventListener("click", function () {
            whatsappModal.style.display = "none";
            callModal.style.display = "none";
          });
        });

        // When user clicks outside the modal
        window.addEventListener("click", function (event) {
          if (event.target == whatsappModal) {
            whatsappModal.style.display = "none";
          }
          if (event.target == callModal) {
            callModal.style.display = "none";
          }
        });

        // Handle number selection for WhatsApp
        const whatsappOptions =
          whatsappModal.querySelectorAll(".number-option");
        whatsappOptions.forEach((option) => {
          option.addEventListener("click", function () {
            const number = this.getAttribute("data-number");
            window.open(`https://wa.me/${number}`, "_blank");
            whatsappModal.style.display = "none";
          });
        });

        // Handle number selection for Call
        const callOptions = callModal.querySelectorAll(".number-option");
        callOptions.forEach((option) => {
          option.addEventListener("click", function () {
            const number = this.getAttribute("data-number");
            window.location.href = `tel:${number}`;
            callModal.style.display = "none";
          });
        });
      });
    </script>

    <div class="floating-buttons">
      
      <a
        href="#"
        class="floating-btn whatsapp-btn"
        data-tooltip="Chat on WhatsApp"
        aria-label="Chat on WhatsApp"
        id="whatsappTrigger"
      >
        <i class="fa-brands fa-whatsapp fa-bounce"></i>
      </a>

      <!-- YouTube Button (unchanged) -->
      <a
        href="https://youtube.com/@bikebuilders-vo2nm?feature=shared"
        class="floating-btn youtube-btn"
        data-tooltip="Watch on YouTube"
        aria-label="Watch on YouTube"
      >
        <i class="fa-brands fa-youtube fa-beat-fade" style="color: #ff0000"></i>
      </a>

      <!-- Call Button -->
      <a
        href="#"
        class="floating-btn call-btn"
        data-tooltip="Call Us"
        aria-label="Call Us"
        id="callTrigger"
      >
        <i class="fa-solid fa-phone-volume fa-shake"></i>
      </a>
       <a
        href="https://www.google.com/maps/place/Bike+builders/@26.1159711,85.3999381,17z/data=!3m1!4b1!4m6!3m5!1s0x39ed11b964ff11bf:0x188a2d7e1473af0b!8m2!3d26.1159664!4d85.404809!16s%2Fg%2F11wftsdzy6?entry=ttu&g_ep=EgoyMDI1MDUyMS4wIKXMDSoASAFQAw%3D%3D"
        class="floating-btn call-btn"
        data-tooltip="Visit Us"
        aria-label="Visit Us"
      >
        <i class="fa-solid fa-motorcycle fa-shake"></i>
      </a>
    </div>

    
    <div id="whatsappModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h3>Choose WhatsApp Number</h3>
        <button class="number-option" data-number="918210283582">
          +91 82102 83582
        </button>
        <button class="number-option" data-number="919876543210">
          +91 98358 44897
        </button>
      </div>
    </div>

    
    <div id="callModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h3>Choose Number to Call</h3>
        <button class="number-option" data-number="918210283582">
          +91 82102 83582
        </button>
        <button class="number-option" data-number="919876543210">
          +91 98358 44897
        </button>
      </div>
    </div>
  </body>
</html>